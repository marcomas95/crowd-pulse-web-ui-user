<div ngClass.gt-sm="main-content-page" fxLayout.xs="column" fxLayout.sm="column" fxLayout="row" fxLayoutWrap>

  <div fxFlex.lt-md="35" fxFlex.lt-sm="100" fxFlex="20" fxLayout="column">

    <!-- select visualization -->
    <mat-card class="filter-card">
      <h3>Custom</h3>
      <mat-form-field class="filter-container">
        <mat-select [(ngModel)]="selected.visualization" (ngModelChange)="clearFilter()" placeholder="Visualization">
          <mat-option><i class="fa fa-times-circle" aria-hidden="true"></i>&nbsp; None</mat-option>
          <mat-option *ngFor="let vis of visualizations" [value]="vis">
            {{ vis.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field *ngIf="selected.visualization && selected.visualization.types.length > 1"
                      class="filter-container">
        <mat-select [(ngModel)]="selected.type" (ngModelChange)="updateChart()" placeholder="Type">
          <mat-option *ngFor="let type of selected.visualization.types" [value]="type">
            {{ type.name | uppercase }}
          </mat-option>
        </mat-select>
      </mat-form-field>

    </mat-card>

    <!-- filters -->
    <div fxFlex.lt-md="35" fxFlex.lt-sm="100" fxFlex="20" *ngIf="selected.visualization && selected.type">
      <mat-card class="filter-card" *ngFor="let filter of selected.type.filters">

        <!-- filter by date -->
        <div *ngIf="filter == filters.filterDate">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.dateFrom" [matDatepicker]="fromDate" placeholder="From Date"
                   (ngModelChange)="updateChart()">
            <mat-datepicker-toggle matSuffix [for]="fromDate"></mat-datepicker-toggle>
            <mat-datepicker #fromDate></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.dateTo" [matDatepicker]="toDate" placeholder="To Date"
                   (ngModelChange)="updateChart()">
            <mat-datepicker-toggle matSuffix [for]="toDate"></mat-datepicker-toggle>
            <mat-datepicker #toDate></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- filter by category -->
        <div *ngIf="filter == filters.filterCategory" class="filter-container">
          <mat-checkbox [(ngModel)]="filter.groupBy" (ngModelChange)="updateChart()">{{filter.name}}</mat-checkbox>
        </div>

        <!-- filter by range map -->
        <div *ngIf="filter == filters.filterCoordinate">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.latitude" type="number" (ngModelChange)="updateChart()" placeholder="Latitude">
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.longitude" type="number" (ngModelChange)="updateChart()" placeholder="Longitude">
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.radius" type="number" (ngModelChange)="updateChart()" placeholder="Radius">
          </mat-form-field>
        </div>

        <!-- filter by source (for messages) -->
        <div *ngIf="filter == filters.filterMessage">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <mat-select [(ngModel)]="filter.source" (ngModelChange)="updateChart()" placeholder="Source">
              <mat-option *ngFor="let source of filter.sources" [value]="source">
                {{ source | uppercase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- filter by source (for connection) -->
        <div *ngIf="filter == filters.filterConnection">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <mat-select [(ngModel)]="filter.source" (ngModelChange)="updateChart()" placeholder="Source">
              <mat-option *ngFor="let source of filter.sources" [value]="source">
                {{ source | uppercase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <!-- limit results -->
        <div *ngIf="filter == filters.filterLimit">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.limit" type="number" (ngModelChange)="updateChart()" placeholder="Number">
          </mat-form-field>
        </div>

      </mat-card>
    </div>
  </div>

  <!-- charts -->
  <div fxFlex.lt-md="65" fxFlex.lt-sm="100" fxFlex="80">

    <!-- loading -->
    <mat-card *ngIf="!selected.visualization && chartsLoading"
              fxLayoutAlign="center" class="stats-card">
      <mat-spinner></mat-spinner>
    </mat-card>

    <!-- custom chart -->
    <mat-card *ngIf="selected.visualization && customChart; else noChart" class="stats-card">
        <h2>{{selected.visualization.name}}</h2>
        <p>{{selected.visualization.description}}</p>
        <div [chart]="customChart"></div>
    </mat-card>

    <ng-template #noChart>

      <!-- map -->
      <mat-card *ngIf="selected.visualization && selected.visualization.id == 'personaldata-gps' && gpsCoordinate; else noMap"
                class="stats-card">
        <h2>{{selected.visualization.name}}</h2>
        <p>{{selected.visualization.description}}</p>
        <agm-map [latitude]="gpsCoordinate[0].latitude" [longitude]="gpsCoordinate[0].longitude">

          <agm-marker [latitude]="gpsCoordinate[0].latitude"
                      [longitude]="gpsCoordinate[0].longitude"
                      [label]="'S'"></agm-marker>

          <agm-marker [latitude]="gpsCoordinate[gpsCoordinate.length - 1].latitude"
                      [longitude]="gpsCoordinate[gpsCoordinate.length - 1].longitude"
                      [label]="'E'"></agm-marker>

          <agm-polyline [strokeColor]="'#FF0000'" [strokeWeight]="2" [geodesic]="true">
            <agm-polyline-point *ngFor="let coor of gpsCoordinate" [latitude]="coor.latitude"
                                [longitude]="coor.longitude">
            </agm-polyline-point>
          </agm-polyline>
        </agm-map>
      </mat-card>

      <ng-template #noMap>

        <!-- messages -->
        <mat-card *ngIf="selected.visualization && selected.visualization.id == 'messages-list'
                          && socialMessages && socialMessages.length; else noMessages" class="stats-card">
          <h2>{{selected.visualization.name}}</h2>
          <p>{{selected.visualization.description}}</p>
          <div class="list-div" fxLayout *ngFor="let message of socialMessages">

            <div *ngIf="message.date" fxFlex="30">
              <p>{{ message.date }}</p>
            </div>

            <div *ngIf="message.source" fxFlex="30">
              <p>{{ message.source }}</p>
            </div>

            <div fxFlex>
              <p *ngIf="message.story">Story: {{ message.story }}</p>
              <p *ngIf="message.text">Text: {{ message.text }} </p>
            </div>

            <mat-divider></mat-divider>
          </div>
        </mat-card>

        <ng-template #noMessages>

          <mat-card *ngIf="selected.visualization && selected.visualization.id == 'likes-list'
                          && likes && likes.length; else noLikes" class="stats-card">
            <h2>{{selected.visualization.name}}</h2>
            <p>{{selected.visualization.description}}</p>
            <div class="list-div" *ngFor="let like of likes">
              <p>{{like.name}}</p>
              <mat-divider></mat-divider>
            </div>
          </mat-card>

          <ng-template #noLikes>

            <mat-card *ngIf="selected.visualization && selected.visualization.id == 'connections-list'
                          && connections && connections.length; else noConnections" class="stats-card">
              <h2>{{selected.visualization.name}}</h2>
              <p>{{selected.visualization.description}}</p>
              <div class="list-div" *ngFor="let connection of connections">
                <p *ngIf="connection.contactName">{{ connection.contactName }}</p>
                <p *ngIf="connection.name">{{ connection.name }}</p>
                <mat-divider></mat-divider>
              </div>
            </mat-card>

            <ng-template #noConnections>

              <!-- no charts -->
              <mat-card *ngIf="!selected.visualization && !customChart
                            && !chartsLoading && !gpsCoordinate
                            && (!socialMessages || !socialMessages.length); else noData"
                        class="stats-card">
                <p>Please select on the of the available visualization from the left/above menu.</p>
              </mat-card>

              <!-- chart/map selected but no data available -->
              <ng-template #noData>
                <mat-card class="stats-card">
                  <p>No data available.</p>
                </mat-card>
              </ng-template>

            </ng-template>
          </ng-template>
        </ng-template>
      </ng-template>
    </ng-template>

  </div>

</div>
