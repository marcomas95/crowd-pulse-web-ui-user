<div ngClass.gt-sm="main-content-page" fxLayout.xs="column" fxLayout.sm="column" fxLayout="row" fxLayoutWrap>

  <div fxFlex.lt-md="35" fxFlex.lt-sm="100" fxFlex="20" fxLayout="column">

    <!-- select visualization -->
    <mat-card class="filter-card">
      <h3>Custom</h3>
      <mat-form-field class="filter-container">
        <mat-select [(ngModel)]="selected.visualization" (ngModelChange)="clearFilter()" placeholder="Visualization">
          <mat-option><i class="fa fa-times-circle" aria-hidden="true"></i>&nbsp; None</mat-option>
          <mat-option *ngFor="let vis of visualizations" [value]="vis">
            {{ vis.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field *ngIf="selected.visualization && selected.visualization.types.length > 1"
                      class="filter-container">
        <mat-select [(ngModel)]="selected.type" (ngModelChange)="updateChart()" placeholder="Type">
          <mat-option *ngFor="let type of selected.visualization.types" [value]="type">
            {{ type.name | uppercase }}
          </mat-option>
        </mat-select>
      </mat-form-field>

    </mat-card>

    <!-- filters -->
    <div fxFlex.lt-md="35" fxFlex.lt-sm="100" fxFlex="20" *ngIf="selected.visualization && selected.type">
      <mat-card class="filter-card" *ngFor="let filter of selected.type.filters">

        <!-- filter by date -->
        <div *ngIf="filter == filters.filterDate">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.dateFrom" [matDatepicker]="fromDate" placeholder="From Date"
                   (ngModelChange)="updateChart()">
            <mat-datepicker-toggle matSuffix [for]="fromDate"></mat-datepicker-toggle>
            <mat-datepicker #fromDate></mat-datepicker>
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.dateTo" [matDatepicker]="toDate" placeholder="To Date"
                   (ngModelChange)="updateChart()">
            <mat-datepicker-toggle matSuffix [for]="toDate"></mat-datepicker-toggle>
            <mat-datepicker #toDate></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- filter by category -->
        <div *ngIf="filter == filters.filterCategory" class="filter-container">
          <mat-checkbox [(ngModel)]="filter.groupBy" (ngModelChange)="updateChart()">{{filter.name}}</mat-checkbox>
        </div>

        <!-- filter by range map -->
        <div *ngIf="filter == filters.filterCoordinate">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.latitude" type="number" (ngModelChange)="updateChart()" placeholder="Latitude">
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.longitude" type="number" (ngModelChange)="updateChart()" placeholder="Longitude">
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.radius" type="number" (ngModelChange)="updateChart()" placeholder="Radius">
          </mat-form-field>
        </div>

        <!-- filter by source (for messages) -->
        <div *ngIf="filter == filters.filterMessage">
          <h3>{{filter.name}}</h3>
          <mat-form-field class="filter-container">
            <mat-select [(ngModel)]="filter.source" (ngModelChange)="updateChart()" placeholder="Source">
              <mat-option *ngFor="let source of filter.sources" [value]="source">
                {{ source | uppercase }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="filter-container">
            <input matInput [(ngModel)]="filter.limit" type="number" (ngModelChange)="updateChart()" placeholder="Limit">
          </mat-form-field>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- charts -->
  <div fxFlex.lt-md="65" fxFlex.lt-sm="100" fxFlex="80">
    <mat-card *ngIf="!selected.visualization && defaultCharts.length == 0 && chartsLoading"
              fxLayoutAlign="center" class="stats-card">
      <mat-spinner></mat-spinner>
    </mat-card>

    <!-- custom chart -->
    <mat-card *ngIf="selected.visualization && customChart" class="stats-card">
        <h2>{{selected.visualization.name}}</h2>
        <div [chart]="customChart"></div>
    </mat-card>

    <!-- map -->
    <mat-card *ngIf="selected.visualization && selected.visualization == 'personaldata-map' && gpsCoordinate"
              class="stats-card">
      <h2>{{selected.visualization.name}}</h2>
      <agm-map [latitude]="gpsCoordinate[0].latitude" [longitude]="gpsCoordinate[0].longitude">

        <agm-marker [latitude]="gpsCoordinate[0].latitude"
                    [longitude]="gpsCoordinate[0].longitude"
                    [label]="'S'"></agm-marker>

        <agm-marker [latitude]="gpsCoordinate[gpsCoordinate.length - 1].latitude"
                    [longitude]="gpsCoordinate[gpsCoordinate.length - 1].longitude"
                    [label]="'E'"></agm-marker>

        <agm-polyline [strokeColor]="'#FF0000'" [strokeWeight]="2" [geodesic]="true">
          <agm-polyline-point *ngFor="let coor of gpsCoordinate" [latitude]="coor.latitude"
                              [longitude]="coor.longitude">
          </agm-polyline-point>
        </agm-polyline>
      </agm-map>
    </mat-card>

    <!-- messages -->
    <mat-card *ngIf="selected.visualization && selected.visualization == 'messages-list'
                     && socialMessages && socialMessages.length" class="stats-card">
      <h2>{{selected.visualization.name}}</h2>
      <div class="message-div" *ngFor="let message of socialMessages">
        <p *ngIf="message.story">Story: {{ message.story }}</p>
        <p *ngIf="message.text">Text: {{ message.text }} </p>
        <mat-divider></mat-divider>
      </div>
    </mat-card>

    <!-- default charts -->
    <div *ngIf="!selected.visualization && defaultCharts.length > 0; else noCharts"
         fxLayout.xs="column" fxLayout.sm="column" fxLayout="row" fxLayoutWrap>
      <mat-card *ngFor="let chartInfo of defaultCharts" fxFlex="45" class="stats-card">
        <h2>{{ chartInfo.name }}</h2>
        <div [chart]="chartInfo.chart"></div>
      </mat-card>
    </div>

    <!-- no charts -->
    <ng-template #noCharts>
      <mat-card *ngIf="!customChart && !chartsLoading && !gpsCoordinate && (!socialMessages || !socialMessages.length)"
                class="stats-card">
        <p>No visualization selected or no data available!</p>
      </mat-card>
    </ng-template>
  </div>

</div>
